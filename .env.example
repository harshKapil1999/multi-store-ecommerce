# Environment Variables Configuration

Copy this template to `.env.local` in the `apps/backend/` directory:

```bash
# =============================================
# Cloudflare R2 Configuration (REQUIRED)
# =============================================
# Get these from your Cloudflare Dashboard
# See R2_SETUP.md for detailed instructions

# Your Cloudflare Account ID (from R2 S3 API endpoint)
# Example: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
CLOUDFLARE_ACCOUNT_ID=

# API Token Access Key ID
# Get this from Cloudflare > Account Settings > API Tokens > R2 API Token
CLOUDFLARE_ACCESS_KEY_ID=

# API Token Secret Access Key
# Get this from Cloudflare > Account Settings > API Tokens > R2 API Token
# ‚ö†Ô∏è Save this immediately - you won't see it again!
CLOUDFLARE_SECRET_ACCESS_KEY=

# Your R2 Bucket Name
# Example: "ecommerce-media" or "nike-store-uploads"
CLOUDFLARE_BUCKET_NAME=

# =============================================
# Database Configuration
# =============================================

# MongoDB connection string
MONGODB_URI=mongodb://localhost:27017/ecommerce

# =============================================
# JWT Configuration
# =============================================

# Secret key for JWT tokens (use a strong random string)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# JWT expiration time
JWT_EXPIRE=7d

# =============================================
# Server Configuration
# =============================================

# Port the server runs on
PORT=4000

# Environment (development, production, test)
NODE_ENV=development

# =============================================
# Optional: Email Configuration
# =============================================

# SMTP settings for sending emails
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# =============================================
# Optional: Payment Gateway (Stripe/PayPal)
# =============================================

# Stripe
STRIPE_PUBLIC_KEY=pk_test_xxxxx
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx

# PayPal
PAYPAL_CLIENT_ID=xxxxx
PAYPAL_SECRET=xxxxx
```

## How to Fill This Out

### 1. Cloudflare R2 Variables (REQUIRED)

#### `CLOUDFLARE_ACCOUNT_ID`
- Go to Cloudflare Dashboard ‚Üí R2
- Click your bucket ‚Üí Settings
- Look for **S3 API Endpoint**: `https://<account-id>.r2.cloudflarestorage.com`
- Copy the `<account-id>` part

Example: `CLOUDFLARE_ACCOUNT_ID=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`

#### `CLOUDFLARE_ACCESS_KEY_ID` and `CLOUDFLARE_SECRET_ACCESS_KEY`
- Cloudflare Dashboard ‚Üí Account Settings (top-right) ‚Üí API Tokens
- Look for **R2 API Token** section
- Click **Create API Token**
- Select permissions: Account > Cloudflare R2 > Edit
- Create token
- Copy both values immediately (Secret won't be shown again!)

Example:
```bash
CLOUDFLARE_ACCESS_KEY_ID=a1b2c3d4e5f6g7h8i9j0
CLOUDFLARE_SECRET_ACCESS_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0
```

#### `CLOUDFLARE_BUCKET_NAME`
- The name you gave your R2 bucket (e.g., `ecommerce-media`)

### 2. Database Variables

#### `MONGODB_URI`
- Local: `mongodb://localhost:27017/ecommerce`
- Atlas Cloud: `mongodb+srv://username:password@cluster.mongodb.net/dbname?retryWrites=true&w=majority`

### 3. JWT Variables

#### `JWT_SECRET`
Generate a strong random string (min 32 characters):
```bash
# On Mac/Linux:
openssl rand -base64 32

# On Windows:
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

## Complete Example

Here's a fully filled example:

```bash
# Cloudflare R2
CLOUDFLARE_ACCOUNT_ID=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
CLOUDFLARE_ACCESS_KEY_ID=a1b2c3d4e5f6g7h8i9j0
CLOUDFLARE_SECRET_ACCESS_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0
CLOUDFLARE_BUCKET_NAME=ecommerce-media

# Database
MONGODB_URI=mongodb://localhost:27017/ecommerce

# JWT
JWT_SECRET=SuperSecretJWTKeyWith32CharactersMinimum123456
JWT_EXPIRE=7d

# Server
PORT=4000
NODE_ENV=development
```

## Checklist

- [ ] Created `.env.local` in `apps/backend/`
- [ ] Added `CLOUDFLARE_ACCOUNT_ID`
- [ ] Added `CLOUDFLARE_ACCESS_KEY_ID`
- [ ] Added `CLOUDFLARE_SECRET_ACCESS_KEY`
- [ ] Added `CLOUDFLARE_BUCKET_NAME`
- [ ] Added `MONGODB_URI`
- [ ] Added `JWT_SECRET`
- [ ] Saved file
- [ ] Restarted dev server

## Verification

After setting up, verify everything works:

```bash
# 1. Start backend
cd apps/backend
pnpm dev

# 2. Should see: "üöÄ Server running on http://localhost:4000"

# 3. Test health endpoint
curl http://localhost:4000/health

# 4. Should respond with: {"status":"ok","message":"Server is running"}
```

## Security Notes

‚ö†Ô∏è **NEVER commit `.env.local` to git!**

1. Add to `.gitignore` (already done by default)
2. Use `.env.example` as template
3. Each developer should create their own `.env.local`
4. For production, use deployment platform's secrets manager

Example `.env.example`:
```bash
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_ACCESS_KEY_ID=your_access_key
CLOUDFLARE_SECRET_ACCESS_KEY=your_secret_key
CLOUDFLARE_BUCKET_NAME=your_bucket_name
MONGODB_URI=your_mongodb_uri
JWT_SECRET=your_jwt_secret
JWT_EXPIRE=7d
PORT=4000
NODE_ENV=development
```

## Need Help?

- See [R2_SETUP.md](./R2_SETUP.md) for detailed Cloudflare configuration
- See [R2_FIX_SUMMARY.md](./R2_FIX_SUMMARY.md) for what was fixed
- Run `bash check-r2-env.sh` to verify variables are set
